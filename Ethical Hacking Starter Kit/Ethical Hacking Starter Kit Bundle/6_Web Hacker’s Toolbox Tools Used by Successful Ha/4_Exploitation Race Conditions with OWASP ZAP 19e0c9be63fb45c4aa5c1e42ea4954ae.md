# 4_Exploitation Race Conditions with OWASP ZAP

# Introduction

- A race condition attack: one of the most dangerous and underestimated attacks in modern web applications
- You will learn how a race condition attack works
- An attacker, who has $1000 in his bank account, can transfer more than $1000 from his bank account as a result of a race condition attack
- The attacker can reuse a one-time discount code many times as a result of a race condition attack

# Exploiting Race Conditions - Case 1 (Money Transfer)

- Use many concurrent requests to transfer $10 from one account to another account
- Race condition happens when money transfer requests are accepted faster than financial transactions are being made
- When the balance goes to zero, there are still a few money transfer requests (already accepted ones) that are waiting to be processed
- It's possible to steal money from a bank via race condition

![Screenshot 2023-05-31 at 1.19.00 PM.png](4_Exploitation%20Race%20Conditions%20with%20OWASP%20ZAP%2019e0c9be63fb45c4aa5c1e42ea4954ae/Screenshot_2023-05-31_at_1.19.00_PM.png)

## Demo

To exploit race conditions in web applications, we can use an ethical hacking tool like OWASP Zed Attack Proxy (ZAP) or Burp Suite. These tools help us to identify vulnerabilities in web applications, including race conditions.

Here are the detailed steps to exploit race conditions using Burp Suite:

1. Open Burp Suite and configure your browser to use Burp Suite as a proxy.
2. Log in to the web application that you want to test.
3. In Burp Suite, go to the "Proxy" tab and click on the "Intercept" sub-tab.
4. Ensure that the "Intercept is on" option is selected.
5. In the web application, initiate the process of transferring money from one account to another.
6. In Burp Suite, you should see the request that was sent to the server for the money transfer. Right-click on the request and select "Send to Repeater".
7. In the Repeater tab, you will see the request that you intercepted in step 6. Click on the "Go" button to send the request to the server.
8. Repeat step 7 multiple times while changing the amount of money being transferred to a higher amount each time.
9. If the race condition vulnerability exists, the server may process the requests out of order, allowing the attacker to transfer more money than what they have in their bank account.

By identifying and exploiting race conditions, we can demonstrate to developers the importance of implementing proper synchronization mechanisms to prevent such vulnerabilities.

# Exploiting Race Conditions - Case 2 (Discount Code)

- Discount code can be used only once
- Use many concurrent requests to redeem a discount code
- Race condition happens when accepting the requests with a discount code is faster than redeeming a discount code
- It's possible to reuse a one-time discount code via a race condition

## Demo

Another example of a race condition vulnerability is the abuse of discount codes. Many web applications offer one-time-use discount codes to their customers. However, if the server does not properly synchronize requests for discount codes, an attacker can potentially use the same code multiple times.

To exploit this vulnerability, we can use Burp Suite as an ethical hacking tool. Here are the steps to follow:

1. Log in to the web application that you want to test.
2. In Burp Suite, go to the "Proxy" tab and click on the "Intercept" sub-tab.
3. Ensure that the "Intercept is on" option is selected.
4. In the web application, initiate the process of using a discount code.
5. In Burp Suite, you should see the request that was sent to the server for the discount code. Right-click on the request and select "Send to Repeater".
6. In the Repeater tab, you will see the request that you intercepted in step 5. Click on the "Go" button to send the request to the server.
7. Repeat step 6 multiple times while using the same discount code each time.
8. If the race condition vulnerability exists, the server may process the requests out of order, allowing the attacker to use the same discount code multiple times.

By identifying and exploiting race conditions, we can demonstrate to developers the importance of implementing proper synchronization mechanisms to prevent such vulnerabilities.

# Case Studies of Award-Wining Race Condition Attacks

- HackerOne: Race condition in performing retest allows duplicated payments:
    
    [https://hackerone.com/reports/429026](https://hackerone.com/reports/429026)
    
- Facebook: Adding multiple single-use coupons to one Facebook ad account.
- Starbucks: Race condition exploit in Starbucks gift cards:
    
    [https://www.schneier.com/blog/archives/2015/05/race condition.html](https://www.schneier.com/blog/archives/2015/05/race)
    
- Keybase: Register multiple users using one invitation (race condition):
    
    [https://hackerone.com/reports/148609](https://hackerone.com/reports/148609)
    
- Reverb: Race condition allows to redeem multiple times gift cards which leads to free "money"
    
    [https://hackerone.com/reports/759247](https://hackerone.com/reports/759247)